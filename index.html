<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title> Soccer Physics </title>
    <style type="text/css">
        html, body {
            width: 100%;
            height: 100%;
            min-width: 100%;
            min-height: 100%;
        }
        body {
            color: #2a324b;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e1e5ee;
        }
        canvas {
            border: 2px solid #A4DDD8;
            background-color: #fbfcff;
        }
    </style>
</head>
<body>
    <canvas id="c"></canvas>
    <script type="text/javascript">

            const canvas = document.getElementById("c");
            const ctx = canvas.getContext("2d");
            const W = 900;
            const H = 600;
            const FPS = 30;
            const _DEBUG = false;
            const floor = 3*H/4;
            const ball_len = 128;
            const net_h = 400;
            const gravity = 1.2;

            const sprites = new Image();
            sprites.src = "images/ball.png";
            const netImage = new Image();
            netImage.src = "images/net-left.jpg";
            const net2Image = new Image();
            net2Image.src = "images/net-right.jpg";

            let keys = {};

            let ball = {
                len: ball_len,
                x: 3*((W-ball_len)/2)+ball_len,
                y: floor-ball_len/3,
                floor: 3*(floor-ball_len/3),
                speed: 30
            };

            let net = {
                x: 0,
                y: 2*floor-net_h+ball.len/10,
                h: 400,
                w: 180
            }

            let net2 = {
                x: 2*(W-net.w/2)
            }

            let team1 = {
                score: 0
            }

            let team2 = {
                score: 0
            }

            let t = 1;
            let game = "game";

            function documentation() {

                document.onkeydown = function keydown(e) {
                    if(!e.isTrusted) return;
                    keys[e.key] = true;
                }

                document.onkeyup = function keyup(e) {
                    if(!e.isTrusted) return;
                    keys[e.key] = false;
                }

            }

            function init() {
                documentation();
                canvas.width = W;
                canvas.height = H;
                ctx.mozImageSmoothingEnabled = false;
                ctx.webkitImageSmoothingEnabled = false;
                ctx.msImageSmoothingEnabled = false;
                ctx.imageSmoothingEnabled = false;

                loop();
            }

            function ball_gravity() {
                if(ball.y < ball.floor) return true;
                return false;
            }

            function check_goal() {
                if((ball.x > 2400+ball.len/6) && ball.y+2*ball.len > 2*net.y) {
                    ball.x = 3*((W-ball.len)/2)+ball.len;
                    ball.y = floor-ball.len/3;
                    team1.score++;
                }
                if((ball.x+ball.len/6 < net.w) && ball.y+2*ball.len > 2*net.y) {
                    ball.x = 3*((W-ball.len)/2)+ball.len;
                    ball.y = floor-ball.len/3;
                    team2.score++;
                }
            }

            function update() {

                if (ball_gravity()) {
                    ball.y+=gravity*t;
                    t++;
                }
                else t = 1;

                if(keys.d || keys['ArrowRight']) {
                    ball.x += ball.speed;
                }
                if(keys.a || keys['ArrowLeft']) {
                    ball.x -= ball.speed;
                }
                if(keys.w || keys['ArrowUp']) {
                    ball.y -= ball.speed;
                }
                if(keys.s || keys['ArrowDown']) {
                    ball.y += ball.speed;
                }

                check_goal();

                if(ball.y > ball.floor) ball.y = ball.floor;
            }

            function draw() {

                ctx.fillStyle = "#111";
                ctx.scale(0.5,0.5);
                ctx.drawImage(netImage,net.x,net.y);
                ctx.drawImage(net2Image,net2.x,net.y);
                ctx.scale(2/3,2/3);
                ctx.drawImage(sprites,ball.x,ball.y);
                ctx.scale(6,6);
                ctx.fillText("Placar: "+team1.score+" x "+team2.score,195,35);
                ctx.setTransform(1, 0, 0, 1, 0, 0);
            }

            function loop() {
                ctx.fillStyle = "#6FD683";
                ctx.fillRect(0, 0, W, H);
                ctx.fillStyle = "#AEE4E4";
                ctx.fillRect(0, 0, W, floor-3);
                update();
                draw();
                requestAnimationFrame(loop);

              }


            init();


    </script>
</body>
</html>
